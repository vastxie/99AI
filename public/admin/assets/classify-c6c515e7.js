
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as re}from"./index-fd8a5577.js";import{d as ue,r as m,Q as U,B,x as de,h as s,R as ie,o as b,c as h,e,f as a,k as pe,m as ce,S as me,U as fe,b as r,l as i,w as _e,I as x,t as z,a as ge,V as ve,W as C,X as be,E as V,q as $}from"./index-e656eb90.js";import{u as ye}from"./utcformatTime-e76e5157.js";import{E as we,Q as Ve}from"./index-d5406c70.js";const ke=["src"],Ce={class:"flex justify-end mr-5"},Ie=ue({__name:"classify",setup(Ue){const P=m(),S=m(0),f=m(!1),k=m(!1),M=m("/api/upload/file"),d=U({name:"",status:"",page:1,size:10}),I=m(),v=m(0),n=U({name:"",des:"",coverImg:"",order:100,status:0}),N=U({name:[{required:!0,message:"请填写分类名称",trigger:"blur"}],des:[{required:!0,message:"请填写分类描述",trigger:"blur"}],coverImg:[{required:!1,message:"请填写分类封面图片地址",trigger:"blur"}],order:[{required:!1,message:"请填写排序ID",trigger:"blur"}],status:[{required:!0,message:"请选择分类状态",trigger:"change"}]}),T=m([]),R=B(()=>v.value?"更新分类":"新增分类"),j=B(()=>v.value?"确认更新":"确认新增");async function p(){try{k.value=!0;const o=await C.queryCats(d),{rows:l,count:y}=o.data;k.value=!1,S.value=y,T.value=l}catch{k.value=!1}}function F(o){v.value=o.id;const{name:l,status:y,des:w,order:_,coverImg:u}=o;be(()=>{Object.assign(n,{name:l,status:y,des:w,order:_,coverImg:u})}),f.value=!0}function K(o){v.value=0,o==null||o.resetFields()}async function O(o){await C.deleteCats({id:o.id}),V.success("删除分类成功"),p()}function Y(o){o==null||o.resetFields(),p()}const G=(o,l)=>{n.coverImg=o.data},L=o=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(o.type)){if(o.size/1024>300)return V.error("当前限制文件最大不超过 300KB!"),!1}else return V.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1;return!0};function Q(o){o==null||o.validate(async l=>{l&&(v.value?(await C.updateCats({id:v.value,...n}),V({type:"success",message:"更新分类成功！"})):(await C.createCats(n),V({type:"success",message:"创建新的分类成功！"})),f.value=!1,p())})}return de(()=>{p()}),(o,l)=>{const y=s("el-alert"),w=re,_=s("el-input"),u=s("el-form-item"),W=s("el-option"),J=s("el-select"),g=s("el-button"),D=s("Plus"),A=s("el-icon"),q=s("el-form"),X=s("el-image"),c=s("el-table-column"),H=s("el-tag"),Z=s("el-popconfirm"),E=s("el-table"),ee=s("el-pagination"),le=s("el-row"),te=s("el-switch"),ae=s("el-upload"),oe=s("el-dialog"),se=ie("loading");return b(),h("div",null,[e(w,null,{default:a(()=>[e(y,{closable:!1,"show-icon":"",title:"应用分类说明",description:"你创建的为系统内置分类、可能会被多个用户收藏、一旦创建、不建议删除、系统或限制已经创建的应用、请合理规范应用以免造成不必要的迷惑。",type:"success"})]),_:1}),e(w,null,{default:a(()=>[e(q,{ref_key:"formRef",ref:P,inline:!0,model:d},{default:a(()=>[e(u,{label:"分类名称",prop:"name"},{default:a(()=>[e(_,{modelValue:d.name,"onUpdate:modelValue":l[0]||(l[0]=t=>d.name=t),placeholder:"分类名称[模糊搜索]",onKeydown:pe(ce(p,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),e(u,{label:"分类状态",prop:"status"},{default:a(()=>[e(J,{modelValue:d.status,"onUpdate:modelValue":l[1]||(l[1]=t=>d.status=t),placeholder:"请选择分类状态",clearable:""},{default:a(()=>[(b(!0),h(me,null,fe(r(we),t=>(b(),x(W,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(g,{type:"primary",onClick:p},{default:a(()=>[i(" 查询 ")]),_:1}),e(g,{onClick:l[2]||(l[2]=t=>Y(r(P)))},{default:a(()=>[i(" 重置 ")]),_:1})]),_:1}),e(g,{type:"success",style:{float:"right"},onClick:l[3]||(l[3]=t=>f.value=!0)},{default:a(()=>[i(" 创建分类 "),e(A,{class:"ml-3"},{default:a(()=>[e(D)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(w,{style:{width:"100%"}},{default:a(()=>[_e((b(),x(E,{border:"",data:r(T),style:{width:"100%"},size:"large"},{default:a(()=>[e(c,{prop:"coverImg",label:"分类封面",width:"120"},{default:a(t=>[e(X,{style:{height:"50px"},src:t.row.coverImg,fit:"fill"},null,8,["src"])]),_:1}),e(c,{prop:"name",label:"分类名称"}),e(c,{prop:"appCount",label:"app数量"}),e(c,{prop:"order",label:"排序ID"}),e(c,{prop:"status",label:"分类状态"},{default:a(t=>[e(H,{type:t.row.status===1?"success":"danger"},{default:a(()=>[i(z(r(Ve)[t.row.status]),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"des",label:"描述信息",width:"300"}),e(c,{prop:"createdAt",label:"创建时间",width:"200"},{default:a(t=>[i(z(r(ye)(t.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),e(c,{label:"操作",width:"200"},{default:a(t=>[e(g,{link:"",type:"primary",size:"small",onClick:ne=>F(t.row)},{default:a(()=>[i(" 编辑 ")]),_:2},1032,["onClick"]),e(Z,{title:"确认删除此分类么?",width:"200","icon-color":"red",onConfirm:ne=>O(t.row)},{reference:a(()=>[e(g,{link:"",type:"danger",size:"small"},{default:a(()=>[i(" 删除分类 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[se,r(k)]]),e(le,{class:"flex justify-end mt-5"},{default:a(()=>[e(ee,{"current-page":d.page,"onUpdate:currentPage":l[4]||(l[4]=t=>d.page=t),"page-size":d.size,"onUpdate:pageSize":l[5]||(l[5]=t=>d.size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:r(S),onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(oe,{modelValue:r(f),"onUpdate:modelValue":l[13]||(l[13]=t=>ve(f)?f.value=t:null),"close-on-click-modal":!1,title:r(R),width:"570",onClose:l[14]||(l[14]=t=>K(r(I)))},{footer:a(()=>[ge("span",Ce,[e(g,{onClick:l[11]||(l[11]=t=>f.value=!1)},{default:a(()=>[i("取消")]),_:1}),e(g,{type:"primary",onClick:l[12]||(l[12]=t=>Q(r(I)))},{default:a(()=>[i(z(r(j)),1)]),_:1})])]),default:a(()=>[e(q,{ref_key:"formPackageRef",ref:I,"label-position":"right","label-width":"100px",model:n,rules:N},{default:a(()=>[e(u,{label:"分类名称",prop:"name"},{default:a(()=>[e(_,{modelValue:n.name,"onUpdate:modelValue":l[6]||(l[6]=t=>n.name=t),placeholder:"请填写分类名称"},null,8,["modelValue"])]),_:1}),e(u,{label:"分类状态",prop:"status"},{default:a(()=>[e(te,{modelValue:n.status,"onUpdate:modelValue":l[7]||(l[7]=t=>n.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),e(u,{label:"封面地址",prop:"coverImg"},{default:a(()=>[e(_,{modelValue:n.coverImg,"onUpdate:modelValue":l[8]||(l[8]=t=>n.coverImg=t),placeholder:"请填写封面图地址 或点击 上传按钮/图片预览 上传图片"},null,8,["modelValue"])]),_:1}),e(u,{label:"封面",prop:"coverImg"},{default:a(()=>[e(ae,{class:"avatar-uploader",action:r(M),"show-file-list":!1,"on-success":G,"before-upload":L},{default:a(()=>[n.coverImg?(b(),h("img",{key:0,src:n.coverImg,style:{width:"100px"},class:"avatar"},null,8,ke)):(b(),x(A,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[e(D)]),_:1}))]),_:1},8,["action"])]),_:1}),e(u,{label:"排序ID",prop:"order"},{default:a(()=>[e(_,{modelValue:n.order,"onUpdate:modelValue":l[9]||(l[9]=t=>n.order=t),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])]),_:1}),e(u,{label:"分类描述",prop:"des"},{default:a(()=>[e(_,{modelValue:n.des,"onUpdate:modelValue":l[10]||(l[10]=t=>n.des=t),type:"textarea",placeholder:"请填写分类介绍信息、用于对外展示...",rows:4},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof $=="function"&&$(Ie);export{Ie as default};
